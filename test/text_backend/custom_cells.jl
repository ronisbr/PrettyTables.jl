## Description #############################################################################
#
# Tests related to custom cells.
#
############################################################################################

@testset "Custom Cells - URL Text Cell" begin
    table = [
        1 "Ronan Arraes Jardim Chagas" UrlTextCell("Ronan Arraes Jardim Chagas", "https://ronanarraes.com")
        2 "Google" UrlTextCell("Google", "https://google.com")
        3 "Apple" UrlTextCell("Apple", "https://apple.com")
        4 "Emojis!" UrlTextCell("ğŸ˜ƒ"^20, "https://emojipedia.org/github/")
    ]

    # == Default ===========================================================================

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Col. 1 â”‚                     Col. 2 â”‚                                   Col. 3 â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚      1 â”‚ Ronan Arraes Jardim Chagas â”‚               \e]8;;https://ronanarraes.com\e\\Ronan Arraes Jardim Chagas\e]8;;\e\\ â”‚
        â”‚      2 â”‚                     Google â”‚                                   \e]8;;https://google.com\e\\Google\e]8;;\e\\ â”‚
        â”‚      3 â”‚                      Apple â”‚                                    \e]8;;https://apple.com\e\\Apple\e]8;;\e\\ â”‚
        â”‚      4 â”‚                    Emojis! â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        """

    result = pretty_table(String, table)
    @test expected == result

    # == Alignment =========================================================================

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Col. 1 â”‚           Col. 2           â”‚                            Col. 3                            â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚   1    â”‚ Ronan Arraes Jardim Chagas â”‚                  \e]8;;https://ronanarraes.com\e\\Ronan Arraes Jardim Chagas\e]8;;\e\\                  â”‚
        â”‚   2    â”‚           Google           â”‚                            \e]8;;https://google.com\e\\Google\e]8;;\e\\                            â”‚
        â”‚   3    â”‚           Apple            â”‚                            \e]8;;https://apple.com\e\\Apple\e]8;;\e\\                             â”‚
        â”‚   4    â”‚          Emojis!           â”‚           \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        """

    result = pretty_table(
        String,
        table;
        alignment = :c,
        columns_width = [-1, -1, 60]
    )
    @test expected == result

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Col. 1 â”‚ Col. 2                     â”‚ Col. 3                                   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ 1      â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;https://ronanarraes.com\e\\Ronan Arraes Jardim Chagas\e]8;;\e\\               â”‚
        â”‚ 2      â”‚ Google                     â”‚ \e]8;;https://google.com\e\\Google\e]8;;\e\\                                   â”‚
        â”‚ 3      â”‚ Apple                      â”‚ \e]8;;https://apple.com\e\\Apple\e]8;;\e\\                                    â”‚
        â”‚ 4      â”‚ Emojis!                    â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        """

    result = pretty_table(
        String,
        table;
        alignment = :l
    )
    @test expected == result

    # == Highlighters ======================================================================

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚\e[1m Col. 1 \e[0mâ”‚\e[1m                     Col. 2 \e[0mâ”‚\e[1m                                   Col. 3 \e[0mâ”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚      1 â”‚ Ronan Arraes Jardim Chagas â”‚ \e[33;1m              \e]8;;https://ronanarraes.com\e\\Ronan Arraes Jardim Chagas\e]8;;\e\\\e[0m â”‚
        â”‚      2 â”‚                     Google â”‚ \e[33;1m                                  \e]8;;https://google.com\e\\Google\e]8;;\e\\\e[0m â”‚
        â”‚      3 â”‚                      Apple â”‚ \e[33;1m                                   \e]8;;https://apple.com\e\\Apple\e]8;;\e\\\e[0m â”‚
        â”‚      4 â”‚                    Emojis! â”‚ \e[33;1m\e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\\e[0m â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        """

    buf = IOBuffer()
    io  = IOContext(buf, :color => true)
    pretty_table(io, table, highlighters = hl_col(3, crayon"yellow bold"))
    result = String(take!(buf))
    @test expected == result

    # == Cropping ==========================================================================

    # -- Column Cropping -------------------------------------------------------------------

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Col. 1 â”‚        Col. 2 â”‚             Col. 3 â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚      1 â”‚ Ronan Arraesâ€¦ â”‚ \e]8;;https://ronanarraes.com\e\\Ronan Arraes Jard\e]8;;\e\\â€¦ â”‚
        â”‚      2 â”‚        Google â”‚             \e]8;;https://google.com\e\\Google\e]8;;\e\\ â”‚
        â”‚      3 â”‚         Apple â”‚              \e]8;;https://apple.com\e\\Apple\e]8;;\e\\ â”‚
        â”‚      4 â”‚       Emojis! â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ \e]8;;\e\\â€¦ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        """

    result = pretty_table(String, table, columns_width = [-1, 13, 18])
    @test expected == result

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Col. 1 â”‚        Col. 2 â”‚              Col. 3 â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚      1 â”‚ Ronan Arraesâ€¦ â”‚ \e]8;;https://ronanarraes.com\e\\Ronan Arraes Jardi\e]8;;\e\\â€¦ â”‚
        â”‚      2 â”‚        Google â”‚              \e]8;;https://google.com\e\\Google\e]8;;\e\\ â”‚
        â”‚      3 â”‚         Apple â”‚               \e]8;;https://apple.com\e\\Apple\e]8;;\e\\ â”‚
        â”‚      4 â”‚       Emojis! â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\â€¦ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        """

    result = pretty_table(String, table, columns_width = [-1, 13, 19])
    @test expected == result

    # -- Display Cropping ------------------------------------------------------------------

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚ Col. 1 â”‚                     Col. 2 â”‚          â‹¯
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚      1 â”‚ Ronan Arraes Jardim Chagas â”‚          â‹¯
        â”‚      2 â”‚                     Google â”‚          â‹¯
        â”‚      3 â”‚                      Apple â”‚          â‹¯
        â”‚      4 â”‚                    Emojis! â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â‹¯
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                          1 column omitted
        """

    result = pretty_table(
        String,
        table;
        display_size = (-1, 50),
        crop = :both
    )
    @test expected == result

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚ Col. 1 â”‚ Col. 2                     â”‚ Col. 3   â‹¯
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚ 1      â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;https://ronanarraes.com\e\\Ronan Ar\e]8;;\e\\ â‹¯
        â”‚ 2      â”‚ Google                     â”‚ \e]8;;https://google.com\e\\Google\e]8;;\e\\   â‹¯
        â”‚ 3      â”‚ Apple                      â”‚ \e]8;;https://apple.com\e\\Apple\e]8;;\e\\    â‹¯
        â”‚ 4      â”‚ Emojis!                    â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â‹¯
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                          1 column omitted
        """

    result = pretty_table(
        String,
        table;
        alignment = :l,
        display_size = (-1, 50),
        crop = :both
    )
    @test expected == result

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚ Col. 1 â”‚ Col. 2                     â”‚ Col. 3    â‹¯
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚ 1      â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;https://ronanarraes.com\e\\Ronan Arr\e]8;;\e\\ â‹¯
        â”‚ 2      â”‚ Google                     â”‚ \e]8;;https://google.com\e\\Google\e]8;;\e\\    â‹¯
        â”‚ 3      â”‚ Apple                      â”‚ \e]8;;https://apple.com\e\\Apple\e]8;;\e\\     â‹¯
        â”‚ 4      â”‚ Emojis!                    â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ \e]8;;\e\\ â‹¯
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                           1 column omitted
        """

    result = pretty_table(
        String,
        table;
        alignment = :l,
        display_size = (-1, 51),
        crop = :both
    )
    @test expected == result

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€
        â”‚ Col. 1 â”‚ Col. 2                     â”‚  â‹¯
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€
        â”‚ 1      â”‚ Ronan Arraes Jardim Chagas â”‚  â‹¯
        â”‚ 2      â”‚ Google                     â”‚  â‹¯
        â”‚ 3      â”‚ Apple                      â”‚  â‹¯
        â”‚ 4      â”‚ Emojis!                    â”‚  â‹¯
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€
                                  1 column omitted
        """

    result = pretty_table(
        String,
        table;
        alignment = :l,
        display_size = (-1, 42),
        crop = :both
    )
    @test expected == result

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚ Col. 1 â”‚ Col. 2                     â”‚ Col. 3 â‹¯
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚ 1      â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;https://ronanarraes.com\e\\Ronan \e]8;;\e\\ â‹¯
        â”‚ 2      â”‚ Google                     â”‚ \e]8;;https://google.com\e\\Google\e]8;;\e\\ â‹¯
        â”‚ 3      â”‚ Apple                      â”‚ \e]8;;https://apple.com\e\\Apple\e]8;;\e\\  â‹¯
        â”‚ 4      â”‚ Emojis!                    â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â‹¯
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                        1 column omitted
        """

    result = pretty_table(
        String,
        table;
        alignment = :l,
        display_size = (-1, 48),
        crop = :both
    )
    @test expected == result

    # -- Multi-line Cells ------------------------------------------------------------------

    table = [
        1 "Website\nRonan Arraes Jardim Chagas" UrlTextCell("Ronan Arraes Jardim Chagas", "https://ronanarraes.com")
        2 "Website\nGoogle" UrlTextCell("Google", "https://google.com")
        3 "Website\nApple" UrlTextCell("Apple", "https://apple.com")
        4 "Website\nEmojis!" UrlTextCell("ğŸ˜ƒ"^20, "https://emojipedia.org/github/")
    ]

    expected = """
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Col. 1 â”‚                     Col. 2 â”‚                                   Col. 3 â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚      1 â”‚                    Website â”‚               \e]8;;https://ronanarraes.com\e\\Ronan Arraes Jardim Chagas\e]8;;\e\\ â”‚
        â”‚        â”‚ Ronan Arraes Jardim Chagas â”‚                                          â”‚
        â”‚      2 â”‚                    Website â”‚                                   \e]8;;https://google.com\e\\Google\e]8;;\e\\ â”‚
        â”‚        â”‚                     Google â”‚                                          â”‚
        â”‚      3 â”‚                    Website â”‚                                    \e]8;;https://apple.com\e\\Apple\e]8;;\e\\ â”‚
        â”‚        â”‚                      Apple â”‚                                          â”‚
        â”‚      4 â”‚                    Website â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â”‚
        â”‚        â”‚                    Emojis! â”‚                                          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        """

    result = pretty_table(String, table, linebreaks = true)
    @test expected == result
end

@testset "Custom Cells - AnsiTextCell" begin
    b = crayon"blue bold"
    y = crayon"yellow bold"
    g = crayon"green bold"

    # == From Strings ======================================================================

    ansi_table = [
        AnsiTextCell("$(g)This $(y)is $(b)awesome!")
        AnsiTextCell("$(g)ğŸ˜ƒğŸ˜ƒ $(y)is $(b)awesome!")
        AnsiTextCell("$(g)Ïƒğ›•Î¸âº $(y)is $(b)awesome!")
    ]

    # -- No Crop ---------------------------------------------------------------------------

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           Col. 1 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ \e[32;1mThis \e[33;1mis \e[34;1mawesome!\e[0m â”‚
    â”‚ \e[32;1mğŸ˜ƒğŸ˜ƒ \e[33;1mis \e[34;1mawesome!\e[0m â”‚
    â”‚ \e[32;1mÏƒğ›•Î¸âº \e[33;1mis \e[34;1mawesome!\e[0m â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    result = pretty_table(String, ansi_table)

    @test result == expected

    # -- Cropping --------------------------------------------------------------------------

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Col. 1 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ \e[32;1mThis \e[33;1mis\e[0mâ€¦ â”‚
    â”‚ \e[32;1mğŸ˜ƒğŸ˜ƒ \e[33;1mis\e[0mâ€¦ â”‚
    â”‚ \e[32;1mÏƒğ›•Î¸âº \e[33;1mis\e[0mâ€¦ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    result = pretty_table(String, ansi_table, maximum_columns_width = 8)
    @test result == expected

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚        â‹¯
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚ \e[32;1mThis \e[33;1mi\e[0m â‹¯
    â”‚ \e[32;1mğŸ˜ƒğŸ˜ƒ \e[33;1mi\e[0m â‹¯
    â”‚ \e[32;1mÏƒğ›•Î¸âº \e[33;1mi\e[0m â‹¯
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€
    1 column omitted
    """

    result = pretty_table(String, ansi_table, display_size = (-1, 10), crop = :both)
    @test result == expected

    # == From Functions ====================================================================

    function f(io)
        b = crayon"blue bold"
        y = crayon"yellow bold"
        g = crayon"green bold"
        print(io, "$(g)This $(y)is $(b)awesome!")
        return nothing
    end

    ansi_table = [
        AnsiTextCell(f, context = (:color => true,))
        AnsiTextCell(f, context = (:color => true,))
        AnsiTextCell(f, context = (:color => true,))
    ]

    # -- No Crop ---------------------------------------------------------------------------

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           Col. 1 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ \e[32;1mThis \e[33;1mis \e[34;1mawesome!\e[0m â”‚
    â”‚ \e[32;1mThis \e[33;1mis \e[34;1mawesome!\e[0m â”‚
    â”‚ \e[32;1mThis \e[33;1mis \e[34;1mawesome!\e[0m â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    result = pretty_table(String, ansi_table)

    @test result == expected

    # -- Cropping --------------------------------------------------------------------------

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Col. 1 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ \e[32;1mThis \e[33;1mis\e[0mâ€¦ â”‚
    â”‚ \e[32;1mThis \e[33;1mis\e[0mâ€¦ â”‚
    â”‚ \e[32;1mThis \e[33;1mis\e[0mâ€¦ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    result = pretty_table(String, ansi_table, maximum_columns_width = 8)
    @test result == expected

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚        â‹¯
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚ \e[32;1mThis \e[33;1mi\e[0m â‹¯
    â”‚ \e[32;1mThis \e[33;1mi\e[0m â‹¯
    â”‚ \e[32;1mThis \e[33;1mi\e[0m â‹¯
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€
    1 column omitted
    """

    result = pretty_table(String, ansi_table, display_size = (-1, 10), crop = :both)
    @test result == expected

    # -- Newlines --------------------------------------------------------------------------

    ansi_table = [
        AnsiTextCell("$(g)This\n$(y)is\n$(b)awesome!")
        AnsiTextCell("$(g)ğŸ˜ƒğŸ˜ƒ\n$(y)is\n$(b)awesome!")
        AnsiTextCell("$(g)Ïƒğ›•Î¸âº\n$(y)is\n$(b)awesome!")
    ]

    expected = """
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Col. 1 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚     \e[32;1mThis\e[0m â”‚
    â”‚       \e[33;1mis\e[0m â”‚
    â”‚ \e[34;1mawesome!\e[0m â”‚
    â”‚     \e[32;1mğŸ˜ƒğŸ˜ƒ\e[0m â”‚
    â”‚       \e[33;1mis\e[0m â”‚
    â”‚ \e[34;1mawesome!\e[0m â”‚
    â”‚     \e[32;1mÏƒğ›•Î¸âº\e[0m â”‚
    â”‚       \e[33;1mis\e[0m â”‚
    â”‚ \e[34;1mawesome!\e[0m â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    """

    result = pretty_table(String, ansi_table)
    @test result == expected
end

mutable struct MyCustomCell <: CustomTextCell
    str::String
end

@testset "Custom Cells - Errors" begin
    mycell = MyCustomCell("Test")

    @test_throws ErrorException PrettyTables.append_suffix_to_line!(mycell, 1, "")
    @test_throws ErrorException PrettyTables.apply_line_padding!(mycell, 1, 10, 10)
    @test_throws ErrorException PrettyTables.crop_line!(mycell, 1, 10)
    @test_throws ErrorException PrettyTables.get_printable_cell_line(mycell, 1)
    @test_throws ErrorException PrettyTables.get_rendered_line(mycell, 1)
    @test_throws ErrorException PrettyTables.parse_cell_text(mycell; autowrap = true)
    @test PrettyTables.reset!(mycell) === nothing
end

