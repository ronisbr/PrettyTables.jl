## Description #############################################################################
#
# Text Back End: Tests related to custom cells.
#
############################################################################################

@testset "Custom Cells" verbose = true begin
    @testset "AnsiTextCell" begin
        b = crayon"blue bold"
        y = crayon"yellow bold"
        g = crayon"green bold"
        r = crayon"reset"

        # == From Strings ==================================================================

        ansi_table = [
            AnsiTextCell("$(g)This $(y)is $(b)awesome!")
            AnsiTextCell("$(g)ğŸ˜ƒğŸ˜ƒ $(y)is $(b)awesome!")
            AnsiTextCell("$(g)Ïƒğ›•Î¸âº $(y)is $(b)awesome!")
        ]

        # -- No Crop -----------------------------------------------------------------------

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Col. 1 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ \e[32;1mThis \e[33;1mis \e[34;1mawesome!\e[0m â”‚
â”‚ \e[32;1mğŸ˜ƒğŸ˜ƒ \e[33;1mis \e[34;1mawesome!\e[0m â”‚
â”‚ \e[32;1mÏƒğ›•Î¸âº \e[33;1mis \e[34;1mawesome!\e[0m â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        result = pretty_table(String, ansi_table)

        @test result == expected

        # -- Cropping ----------------------------------------------------------------------

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Col. 1 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ \e[32;1mThis \e[33;1misâ€¦\e[0m â”‚
â”‚ \e[32;1mğŸ˜ƒğŸ˜ƒ \e[33;1misâ€¦\e[0m â”‚
â”‚ \e[32;1mÏƒğ›•Î¸âº \e[33;1misâ€¦\e[0m â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        result = pretty_table(String, ansi_table, maximum_data_column_widths = 8)
        @test result == expected

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚        â‹¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ \e[32;1mThis \e[33;1mi\e[0m â‹¯
â”‚ \e[32;1mğŸ˜ƒğŸ˜ƒ \e[33;1mi\e[0m â‹¯
â”‚ \e[32;1mÏƒğ›•Î¸âº \e[33;1mi\e[0m â‹¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€
1 column omitted
"""

        result = pretty_table(String, ansi_table, display_size = (-1, 10))
        @test result == expected

        # == From Functions ================================================================

        function f(io)
            b = crayon"blue bold"
            y = crayon"yellow bold"
            g = crayon"green bold"
            print(io, "$(g)This $(y)is $(b)awesome!")
            return nothing
        end

        ansi_table = [
            AnsiTextCell(f, context = (:color => true,))
            AnsiTextCell(f, context = (:color => true,))
            AnsiTextCell(f, context = (:color => true,))
        ]

        # -- No Crop -----------------------------------------------------------------------

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Col. 1 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ \e[32;1mThis \e[33;1mis \e[34;1mawesome!\e[0m â”‚
â”‚ \e[32;1mThis \e[33;1mis \e[34;1mawesome!\e[0m â”‚
â”‚ \e[32;1mThis \e[33;1mis \e[34;1mawesome!\e[0m â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        result = pretty_table(String, ansi_table)

        @test result == expected

        # -- Cropping ----------------------------------------------------------------------

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Col. 1 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ \e[32;1mThis \e[33;1misâ€¦\e[0m â”‚
â”‚ \e[32;1mThis \e[33;1misâ€¦\e[0m â”‚
â”‚ \e[32;1mThis \e[33;1misâ€¦\e[0m â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        result = pretty_table(String, ansi_table, maximum_data_column_widths = 8)
        @test result == expected

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚        â‹¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ \e[32;1mThis \e[33;1mi\e[0m â‹¯
â”‚ \e[32;1mThis \e[33;1mi\e[0m â‹¯
â”‚ \e[32;1mThis \e[33;1mi\e[0m â‹¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€
1 column omitted
"""

        result = pretty_table(String, ansi_table, display_size = (-1, 10))
        @test result == expected

        # -- Newlines ----------------------------------------------------------------------

        ansi_table = [
            AnsiTextCell("$(g)This$(r)\n$(y)is\n$(b)awesome!")
            AnsiTextCell("$(g)ğŸ˜ƒğŸ˜ƒ\n$(y)is\n$(b)awesome!")
            AnsiTextCell("$(g)Ïƒğ›•Î¸âº\n$(y)is\n$(b)awesome!")
        ]

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Col. 1 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     \e[32;1mThis\e[0m â”‚
â”‚       \e[33;1mis\e[0m â”‚
â”‚ \e[33m\e[1m\e[34;1mawesome!\e[0m â”‚
â”‚     \e[32;1mğŸ˜ƒğŸ˜ƒ\e[0m â”‚
â”‚ \e[32m\e[1m      \e[33;1mis\e[0m â”‚
â”‚ \e[33m\e[1m\e[34;1mawesome!\e[0m â”‚
â”‚     \e[32;1mÏƒğ›•Î¸âº\e[0m â”‚
â”‚ \e[32m\e[1m      \e[33;1mis\e[0m â”‚
â”‚ \e[33m\e[1m\e[34;1mawesome!\e[0m â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        result = pretty_table(String, ansi_table; line_breaks = true)
        @test result == expected
    end

    @testset "UrlTextCell" begin
        table = [
            1 "Ronan Arraes Jardim Chagas" UrlTextCell("Ronan Arraes Jardim Chagas", "https://ronanarraes.com")
            2 "Google" UrlTextCell("Google", "https://google.com")
            3 "Apple" UrlTextCell("Apple", "https://apple.com")
            4 "Emojis!" UrlTextCell("ğŸ˜ƒ"^20, "https://emojipedia.org/github/")
        ]

        # == Default =======================================================================

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Col. 1 â”‚                     Col. 2 â”‚                                   Col. 3 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1 â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;https://ronanarraes.com\e\\              Ronan Arraes Jardim Chagas\e]8;;\e\\ â”‚
â”‚      2 â”‚                     Google â”‚ \e]8;;https://google.com\e\\                                  Google\e]8;;\e\\ â”‚
â”‚      3 â”‚                      Apple â”‚ \e]8;;https://apple.com\e\\                                   Apple\e]8;;\e\\ â”‚
â”‚      4 â”‚                    Emojis! â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        result = pretty_table(String, table)
        @test result == expected

        # == Alignment =====================================================================

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Col. 1 â”‚           Col. 2           â”‚                            Col. 3                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   1    â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;https://ronanarraes.com\e\\                 Ronan Arraes Jardim Chagas                 \e]8;;\e\\ â”‚
â”‚   2    â”‚           Google           â”‚ \e]8;;https://google.com\e\\                           Google                           \e]8;;\e\\ â”‚
â”‚   3    â”‚           Apple            â”‚ \e]8;;https://apple.com\e\\                            Apple                           \e]8;;\e\\ â”‚
â”‚   4    â”‚          Emojis!           â”‚ \e]8;;https://emojipedia.org/github/\e\\          ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ          \e]8;;\e\\ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        result = pretty_table(
            String,
            table;
            alignment = :c,
            fixed_data_column_widths = [-1, -1, 60]
        )
        @test result == expected

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Col. 1 â”‚ Col. 2                     â”‚ Col. 3                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1      â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;https://ronanarraes.com\e\\Ronan Arraes Jardim Chagas              \e]8;;\e\\ â”‚
â”‚ 2      â”‚ Google                     â”‚ \e]8;;https://google.com\e\\Google                                  \e]8;;\e\\ â”‚
â”‚ 3      â”‚ Apple                      â”‚ \e]8;;https://apple.com\e\\Apple                                   \e]8;;\e\\ â”‚
â”‚ 4      â”‚ Emojis!                    â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        result = pretty_table(
            String,
            table;
            alignment = :l
        )
        @test result == expected

        # == Highlighters ==================================================================

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚\e[1m Col. 1 \e[0mâ”‚\e[1m                     Col. 2 \e[0mâ”‚\e[1m                                   Col. 3 \e[0mâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1 â”‚ Ronan Arraes Jardim Chagas â”‚\e[33;1m \e]8;;https://ronanarraes.com\e\\              Ronan Arraes Jardim Chagas\e]8;;\e\\ \e[0mâ”‚
â”‚      2 â”‚                     Google â”‚\e[33;1m \e]8;;https://google.com\e\\                                  Google\e]8;;\e\\ \e[0mâ”‚
â”‚      3 â”‚                      Apple â”‚\e[33;1m \e]8;;https://apple.com\e\\                                   Apple\e]8;;\e\\ \e[0mâ”‚
â”‚      4 â”‚                    Emojis! â”‚\e[33;1m \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ \e[0mâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        hl = TextHighlighter(
            (data, i, j) -> j == 3,
            crayon"yellow bold"
        )

        result = pretty_table(
            String,
            table;
            color = true,
            highlighters = [hl]
        )
        @test result == expected

        # == Cropping ======================================================================

        # -- Column Cropping ---------------------------------------------------------------

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Col. 1 â”‚        Col. 2 â”‚             Col. 3 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1 â”‚ Ronan Arraesâ€¦ â”‚ \e]8;;https://ronanarraes.com\e\\Ronan Arraes Jardâ€¦\e]8;;\e\\ â”‚
â”‚      2 â”‚        Google â”‚ \e]8;;https://google.com\e\\            Google\e]8;;\e\\ â”‚
â”‚      3 â”‚         Apple â”‚ \e]8;;https://apple.com\e\\             Apple\e]8;;\e\\ â”‚
â”‚      4 â”‚       Emojis! â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ â€¦\e]8;;\e\\ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        result = pretty_table(
            String,
            table;
            fixed_data_column_widths = [-1, 13, 18]
        )
        @test result == expected

        # -- Display Cropping --------------------------------------------------------------

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ Col. 1 â”‚                     Col. 2 â”‚          â‹¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚      1 â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;https://ronanarraes.com\e\\        \e]8;;\e\\ â‹¯
â”‚      2 â”‚                     Google â”‚ \e]8;;https://google.com\e\\        \e]8;;\e\\ â‹¯
â”‚      3 â”‚                      Apple â”‚ \e]8;;https://apple.com\e\\        \e]8;;\e\\ â‹¯
â”‚      4 â”‚                    Emojis! â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â‹¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  1 column omitted
"""

        result = pretty_table(
            String,
            table;
            display_size = (-1, 50)
        )
        @test result == expected

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ Col. 1 â”‚ Col. 2                     â”‚ Col. 3   â‹¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ 1      â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;https://ronanarraes.com\e\\Ronan Ar\e]8;;\e\\ â‹¯
â”‚ 2      â”‚ Google                     â”‚ \e]8;;https://google.com\e\\Google  \e]8;;\e\\ â‹¯
â”‚ 3      â”‚ Apple                      â”‚ \e]8;;https://apple.com\e\\Apple   \e]8;;\e\\ â‹¯
â”‚ 4      â”‚ Emojis!                    â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â‹¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                  1 column omitted
"""

        result = pretty_table(
            String,
            table;
            alignment = :l,
            display_size = (-1, 50)
        )
        @test result == expected

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€
â”‚ Col. 1 â”‚ Col. 2                     â”‚  â‹¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€
â”‚ 1      â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;\e\\ â‹¯
â”‚ 2      â”‚ Google                     â”‚ \e]8;;\e\\ â‹¯
â”‚ 3      â”‚ Apple                      â”‚ \e]8;;\e\\ â‹¯
â”‚ 4      â”‚ Emojis!                    â”‚ \e]8;;\e\\ â‹¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€
                          1 column omitted
"""
        result = pretty_table(
            String,
            table;
            alignment = :l,
            display_size = (-1, 42)
        )
        @test result == expected


        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ Col. 1 â”‚ Col. 2                     â”‚ Col. 3 â‹¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ 1      â”‚ Ronan Arraes Jardim Chagas â”‚ \e]8;;https://ronanarraes.com\e\\Ronan \e]8;;\e\\ â‹¯
â”‚ 2      â”‚ Google                     â”‚ \e]8;;https://google.com\e\\Google\e]8;;\e\\ â‹¯
â”‚ 3      â”‚ Apple                      â”‚ \e]8;;https://apple.com\e\\Apple \e]8;;\e\\ â‹¯
â”‚ 4      â”‚ Emojis!                    â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â‹¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                1 column omitted
"""
        result = pretty_table(
            String,
            table;
            alignment = :l,
            display_size = (-1, 48)
        )
        @test result == expected

        # == Multi-line Cells ==============================================================

        table = [
            1 "Website\nRonan Arraes Jardim Chagas" UrlTextCell("Ronan Arraes Jardim Chagas", "https://ronanarraes.com")
            2 "Website\nGoogle" UrlTextCell("Google", "https://google.com")
            3 "Website\nApple" UrlTextCell("Apple", "https://apple.com")
            4 "Website\nEmojis!" UrlTextCell("ğŸ˜ƒ"^20, "https://emojipedia.org/github/")
        ]

        expected = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Col. 1 â”‚                     Col. 2 â”‚                                   Col. 3 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      1 â”‚                    Website â”‚ \e]8;;https://ronanarraes.com\e\\              Ronan Arraes Jardim Chagas\e]8;;\e\\ â”‚
â”‚        â”‚ Ronan Arraes Jardim Chagas â”‚                                          â”‚
â”‚      2 â”‚                    Website â”‚ \e]8;;https://google.com\e\\                                  Google\e]8;;\e\\ â”‚
â”‚        â”‚                     Google â”‚                                          â”‚
â”‚      3 â”‚                    Website â”‚ \e]8;;https://apple.com\e\\                                   Apple\e]8;;\e\\ â”‚
â”‚        â”‚                      Apple â”‚                                          â”‚
â”‚      4 â”‚                    Website â”‚ \e]8;;https://emojipedia.org/github/\e\\ğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒğŸ˜ƒ\e]8;;\e\\ â”‚
â”‚        â”‚                    Emojis! â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

        result = pretty_table(
            String,
            table;
            line_breaks = true
        )
        @test result == expected
    end
end
